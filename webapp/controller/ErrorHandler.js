/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object","sap/m/MessageBox"],function(U,M){"use strict";return U.extend("fin.gl.journalentry.upload.controller.ErrorHandler",{constructor:function(c){this._oResourceBundle=c.getModel("i18n").getResourceBundle();this._oComponent=c;this._oModel=c.getModel();this._bMessageOpen=false;this._sErrorText=this._oResourceBundle.getText("errorText");this._oModel.attachMetadataFailed(function(e){var p=e.getParameters();this._showServiceError(p.response);},this);this._oModel.attachRequestFailed(function(e){var p=e.getParameters();this._handleRequestFailed(p);},this);},_handleRequestFailed:function(p){if(p.response.statusCode!=="404"||(p.response.statusCode===404&&p.response.responseText.indexOf("Cannot POST")===0)){try{var r=jQuery.parseJSON(p.response.responseText);if(r.error&&r.error.code==="FINS_ACDOC_POST/100"){if(r.error.innererror&&r.error.innererror.errordetails){var e=r.error.innererror.errordetails;var n,l;for(var i=0;i<e.length;i++){if(e[i].code==="FDC_POSTING_001/033"){n=e[i].message;}if(e[i].code==="FDC_POSTING_001/013"){l=e[i].message;}}if(l){this._sErrorText=l;}else if(n){this._sErrorText=n;}}}}catch(a){}this._showServiceError(p.response);}},_showServiceError:function(d){if(this._bMessageOpen){return;}this._bMessageOpen=true;M.error(this._sErrorText,{id:"serviceErrorMessageBox",details:d,styleClass:this._oComponent.getContentDensityClass(),actions:[M.Action.CLOSE],onClose:function(){this._bMessageOpen=false;}.bind(this)});}});});
